{% extends "base.html" %}

{% block content %}
<section>
  <h2>Manage</h2>

  <div style="display:flex; gap:0.75rem; flex-wrap:wrap; margin: 0.75rem 0 1.25rem 0;">
    <a class="btn-secondary" href="{{ url_for('backup_download') }}">Download Backup (ZIP)</a>
    <a class="btn-secondary" href="{{ url_for('restore_backup') }}">Restore from Backup</a>
  </div>

  <p class="notes">
    Backups include your <code>prompts.db</code> database and any thumbnail files.
    Restoring will replace your current database. A safety backup is created automatically.
  </p>

  <hr style="margin: 1.25rem 0; border: 0; border-top: 1px solid #333;" />

  <h3>Prompt Groups</h3>
  <p class="notes">Use groups to bundle prompts that belong together.</p>
  <form method="post" action="{{ url_for('add_group') }}" style="display:flex; gap:0.5rem; flex-wrap:wrap; align-items:center;">
    <input type="text" name="name" placeholder="New group name" required>
    <input type="text" name="description" placeholder="(optional description)" style="flex:1; min-width:220px;">
    <button type="submit">Add</button>
  </form>

  <div style="margin-top:0.75rem;">
    {% for g in groups %}
      <div style="display:flex; gap:0.5rem; align-items:center; margin-bottom:0.35rem;">
        <span style="flex:1;">
          <strong>{{ g.name }}</strong>
          {% if g.description %}<span style="opacity:0.7; font-size:0.9em;"> Â· {{ g.description }}</span>{% endif %}
        </span>
        <form method="post" action="{{ url_for('delete_group') }}" onsubmit="return confirm('Delete group? Prompts will be ungrouped.');">
          <input type="hidden" name="id" value="{{ g.id }}">
          <button type="submit" class="danger">Delete</button>
        </form>
      </div>
    {% endfor %}
  </div>

  <hr style="margin: 1.25rem 0; border: 0; border-top: 1px solid #333;" />

  <h3>Categories</h3>
  <form method="post" action="{{ url_for('add_category') }}" style="display:flex; gap:0.5rem; flex-wrap:wrap; align-items:center;">
    <input type="text" name="name" placeholder="New category" required>
    <button type="submit">Add</button>
  </form>

  <div style="margin-top:0.75rem;">
    {% for c in categories %}
      <div style="display:flex; gap:0.5rem; align-items:center; margin-bottom:0.35rem;">
        <span style="flex:1;">{{ c }}</span>
        <form method="post" action="{{ url_for('delete_category') }}">
          <input type="hidden" name="name" value="{{ c }}">
          <button type="submit" class="danger">Delete</button>
        </form>
      </div>
    {% endfor %}
  </div>

  <hr style="margin: 1.25rem 0; border: 0; border-top: 1px solid #333;" />

  <h3>Tools</h3>
  <form method="post" action="{{ url_for('add_tool') }}" style="display:flex; gap:0.5rem; flex-wrap:wrap; align-items:center;">
    <input type="text" name="name" placeholder="New tool" required>
    <button type="submit">Add</button>
  </form>

  <div style="margin-top:0.75rem;">
    {% for t in tools %}
      <div style="display:flex; gap:0.5rem; align-items:center; margin-bottom:0.35rem;">
        <span style="flex:1;">{{ t }}</span>
        <form method="post" action="{{ url_for('delete_tool') }}">
          <input type="hidden" name="name" value="{{ t }}">
          <button type="submit" class="danger">Delete</button>
        </form>
      </div>
    {% endfor %}
  </div>

</section>
{% endblock %}
