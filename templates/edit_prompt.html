{% extends "base.html" %}

{% block content %}
<section>
  <h2>
    {% if prompt and prompt.id %}
      Edit Prompt
    {% else %}
      New Prompt
    {% endif %}
  </h2>

  {% if imported_preview %}
    <p class="notes">Imported preview: review and click Save to add it to your library.</p>
  {% endif %}

  {# Decide where the Save button should post to #}
  {% if prompt and prompt.id %}
    {% set form_action = url_for('edit_prompt', prompt_id=prompt.id) %}
  {% else %}
    {% set form_action = url_for('new_prompt') %}
  {% endif %}

  <form method="post" action="{{ form_action }}">
    <label>Title
      <input type="text" name="title" value="{{ prompt.title if prompt else '' }}" required>
    </label>

    <label>Category
      <select name="category">
        {% for cat in categories %}
          <option value="{{ cat }}"
            {% if prompt and prompt.category == cat %}selected{% endif %}>
            {{ cat }}
          </option>
        {% endfor %}
      </select>
    </label>

    <label>Tool
      <select name="tool">
        {% for t in tools %}
          <option value="{{ t }}"
            {% if prompt and prompt.tool == t %}selected{% endif %}>
            {{ t }}
          </option>
        {% endfor %}
      </select>
    </label>

    <label>Prompt type
      <select name="prompt_type">
        {% for pt in prompt_types %}
          <option value="{{ pt }}"
            {% if prompt and prompt.prompt_type == pt %}selected{% endif %}>
            {{ pt }}
          </option>
        {% endfor %}
      </select>
    </label>

    <label>Content (use [[placeholders]] for variable parts)
      <textarea name="content" rows="12" required>{{ prompt.content if prompt else '' }}</textarea>
    </label>

    <label>Notes (optional â€“ e.g. sampler, CFG, resolution)
      <textarea name="notes" rows="4">{{ prompt.notes if prompt and prompt.notes else '' }}</textarea>
    </label>

    <button type="submit">Save</button>
  </form>
</section>
{% endblock %}
