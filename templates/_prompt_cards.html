{% for p in prompts %}
<li class="prompt-card drop-zone" data-id="{{ p.id }}">
  <div class="drop-overlay"></div>

  <div class="organise-checkbox" style="display:none; position:absolute; top:10px; left:10px; z-index:10;">
    <input type="checkbox"
           class="bulkCheck"
           name="prompt_ids"
           value="{{ p.id }}"
           form="bulkForm"
           style="transform:scale(1.5);">
  </div>

  <div class="card-thumb-area">
    {% if p.thumbnail %}
      <img class="thumb" src="{{ url_for('static', filename=p.thumbnail) }}" alt="Thumbnail">
    {% else %}
      <div class="thumb-placeholder">{{ (p.category or '?')[:1] }}</div>
    {% endif %}
  </div>

  <div class="prompt-meta">
    <div style="display:flex; justify-content:space-between; align-items:start; gap:0.75rem;">
      <h3 style="margin:0; min-width:0; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">
        {{ p.title }}
      </h3>

      <div style="display:flex; gap:4px; flex-wrap:wrap; justify-content:flex-end;">
        {% if p.child_count and p.child_count > 0 %}
          <a href="{{ url_for('index', view_family=p.id) }}"
             title="View variants"
             style="background:#00bfff; color:#fff; text-decoration:none; padding:2px 8px; border-radius:4px; font-size:0.75em; font-weight:bold;">
            ðŸ“‚ {{ p.child_count }} Variants
          </a>
        {% endif %}

        {% if p.parent_id %}
          <span title="Is a variant"
                style="background:#333; padding:2px 6px; border-radius:4px; font-size:0.7em; color:#ccc;">
            â†³ Variant
          </span>
        {% endif %}
      </div>
    </div>

    <p class="notes" style="margin:0.25rem 0 0.5rem 0; font-size:0.85em; opacity:0.7;">
      {{ p.category }} Â· {{ p.tool }}
    </p>

    {% if p.tags %}
      <div style="display:flex; gap:0.25rem; flex-wrap:wrap; margin-bottom:0.5rem;">
        {% for t in p.tags %}
          <span style="background:#333; color:#ccc; font-size:0.7em; padding:2px 6px; border-radius:10px;">
            {{ t }}
          </span>
        {% endfor %}
      </div>
    {% endif %}

    <div class="quick-actions" style="display:flex; gap:0.5rem; flex-wrap:wrap;">
      <button type="button" class="btn-secondary" onclick="togglePreview({{ p.id }})">Preview</button>
      <button type="button" class="btn-secondary" onclick="copyPrompt({{ p.id }})">Copy</button>
      <a class="btn-secondary" href="{{ url_for('render_prompt', prompt_id=p.id) }}">Use</a>
      <a class="btn-secondary" href="{{ url_for('edit_prompt', prompt_id=p.id) }}">Edit</a>

      <form method="post"
            action="{{ url_for('delete_prompt', prompt_id=p.id) }}"
            style="display:inline;"
            onsubmit="return confirm('Delete permanently?');">
        <button type="submit" class="btn-danger" style="padding:0.4rem 0.6rem;">&times;</button>
      </form>
    </div>

    <div id="preview-{{ p.id }}"
         class="prompt-preview"
         style="display:none; margin-top:0.5rem; background:#111; padding:0.5rem; border-radius:4px;">
      <pre style="white-space:pre-wrap; margin:0; font-size:0.9em; max-height:200px; overflow-y:auto;">{{ p.content }}</pre>
    </div>

  </div>
</li>
{% endfor %}
